<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create 3D convex and alpha hulls with lighting — stat_hull_3d • ggcube</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create 3D convex and alpha hulls with lighting — stat_hull_3d"><meta name="description" content="stat_hull_3d() turns 3D point clouds into surface hulls consisting of triangular polygons,
using either convex hull or alpha shape algorithms. It computes surface normals and applies
various lighting models to create realistic 3D surface visualizations."><meta property="og:description" content="stat_hull_3d() turns 3D point clouds into surface hulls consisting of triangular polygons,
using either convex hull or alpha shape algorithms. It computes surface normals and applies
various lighting models to create realistic 3D surface visualizations."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggcube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthewkling/ggcube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create 3D convex and alpha hulls with lighting</h1>
      <small class="dont-index">Source: <a href="https://github.com/matthewkling/ggcube/blob/main/R/stat-hull-3d.R" class="external-link"><code>R/stat-hull-3d.R</code></a></small>
      <div class="d-none name"><code>stat_hull_3d.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>stat_hull_3d()</code> turns 3D point clouds into surface hulls consisting of triangular polygons,
using either convex hull or alpha shape algorithms. It computes surface normals and applies
various lighting models to create realistic 3D surface visualizations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stat_hull_3d</span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  geom <span class="op">=</span> <span class="va">GeomPolygon3D</span>,</span>
<span>  position <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"convex"</span>,</span>
<span>  radius <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  light <span class="op">=</span> <span class="fu"><a href="lighting.html">lighting</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  inherit.aes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mapping">mapping<a class="anchor" aria-label="anchor" href="#arg-mapping"></a></dt>
<dd><p>Set of aesthetic mappings created by <code><a href="aes.html">aes()</a></code>. The required
aesthetics are <code>x</code>, <code>y</code>, and <code>z</code>. Additional aesthetics can use computed
variables with <code><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat()</a></code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The data to be displayed in this layer.</p></dd>


<dt id="arg-geom">geom<a class="anchor" aria-label="anchor" href="#arg-geom"></a></dt>
<dd><p>The geometric object to use display the data. Defaults to
GeomPolygon3D for proper 3D depth sorting.</p></dd>


<dt id="arg-position">position<a class="anchor" aria-label="anchor" href="#arg-position"></a></dt>
<dd><p>Position adjustment, defaults to "identity".</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Triangulation method. Either:</p><ul><li><p><code>"convex"</code>: Convex hull triangulation (default)</p></li>
<li><p><code>"alpha"</code>: Alpha shape triangulation (can capture non-convex topologies)</p></li>
</ul></dd>


<dt id="arg-radius">radius<a class="anchor" aria-label="anchor" href="#arg-radius"></a></dt>
<dd><p>Square root of "alpha" parameter when alpha method is used.
A face is included in the resulting alpha shape if it can be "exposed" by a sphere of this radius.
If NULL (the default), a simple heuristic based on the data scale is used to calculate a radius value.
Note that alpha shapes are quite sensitive to the coordinate scales of your data. See Details section.</p></dd>


<dt id="arg-light">light<a class="anchor" aria-label="anchor" href="#arg-light"></a></dt>
<dd><p>A lighting specification object created by <code><a href="lighting.html">lighting()</a></code></p></dd>


<dt id="arg-inherit-aes">inherit.aes<a class="anchor" aria-label="anchor" href="#arg-inherit-aes"></a></dt>
<dd><p>If <code>FALSE</code>, overrides the default aesthetics.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments passed on to <code><a href="https://ggplot2.tidyverse.org/reference/layer.html" class="external-link">layer()</a></code>, such as <code>sort_method</code> and <code>scale_depth</code>
arguments to <code><a href="geom_polygon_3d.html">geom_polygon_3d()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="grouping">Grouping<a class="anchor" aria-label="anchor" href="#grouping"></a></h2>


<p><code>stat_hull_3d()</code> respects ggplot2 grouping aesthetics. To create separate hulls for different
subsets of your data, use <code>aes(group = category_variable)</code> or similar grouping aesthetics.
Each group will get its own independent hull calculation.</p>
    </div>
    <div class="section level2">
    <h2 id="alpha-scale-sensitivity">Alpha scale sensitivity<a class="anchor" aria-label="anchor" href="#alpha-scale-sensitivity"></a></h2>


<p><strong>Alpha shape method is highly sensitive to coordinate scales.</strong> The <code>alpha</code> parameter
that works for data scaled 0-1 will likely fail for data scaled 0-1000.</p>
<p><strong>Guidelines for choosing radius:</strong></p><ul><li><p>Start with <code>alpha = 1.0</code> and adjust based on results</p></li>
<li><p>For data with mixed scales (e.g., x: 0-1, y: 0-1000), consider rescaling your data first</p></li>
<li><p>Larger alpha values → smoother, more connected surfaces</p></li>
<li><p>Smaller alpha values → more detailed surfaces, but may fragment</p></li>
<li><p>If you get no triangles, try increasing alpha by 10x</p></li>
<li><p>If surface fills unwanted holes, try decreasing alpha by 10x</p></li>
</ul><p><strong>Example scale effects:</strong></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># These require very different alpha values:</span></span>
<span><span class="va">data_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/stat_hull_3d.html">stat_hull_3d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_small</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>    <span class="co"># Might work well</span></span>
<span><span class="fu"><a href="../reference/stat_hull_3d.html">stat_hull_3d</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_large</span>, alpha <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>     <span class="co"># Might need much larger alpha</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="computed-variables">Computed variables<a class="anchor" aria-label="anchor" href="#computed-variables"></a></h2>


<ul><li><p><code>light</code>: Computed lighting value (numeric for most methods, hex color for <code>normal_rgb</code>)</p></li>
<li><p><code>normal_x</code>, <code>normal_y</code>, <code>normal_z</code>: Surface normal components</p></li>
<li><p><code>triangle_index</code>: Sequential triangle number (useful for debugging)</p></li>
<li><p><code>face_id</code>: Triangle group identifier</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="aesthetics">Aesthetics<a class="anchor" aria-label="anchor" href="#aesthetics"></a></h2>


<p><code>stat_hull_3d()</code> requires the following aesthetics:</p><ul><li><p><strong>x</strong>: X coordinate</p></li>
<li><p><strong>y</strong>: Y coordinate</p></li>
<li><p><strong>z</strong>: Z coordinate</p></li>
</ul><p>Computed variables can be accessed using <code><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat()</a></code>:</p><ul><li><p><code>after_stat(light)</code>: Lighting values</p></li>
<li><p><code>after_stat(normal_x)</code>: X component of surface normal</p></li>
<li><p><code>after_stat(normal_y)</code>: Y component of surface normal</p></li>
<li><p><code>after_stat(normal_z)</code>: Z component of surface normal</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="coord_3d.html">coord_3d()</a></code> for 3D coordinate systems, <a href="geom_polygon_3d.html">geom_polygon_3d</a> for the
default geometry with depth sorting, <code><a href="lighting.html">lighting()</a></code> for lighting specifications.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convex hull</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sphere_points</span>, <span class="fu"><a href="aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">stat_hull_3d</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"convex"</span>, fill <span class="op">=</span> <span class="st">"gray40"</span>,</span></span>
<span class="r-in"><span>               light <span class="op">=</span> <span class="fu"><a href="lighting.html">lighting</a></span><span class="op">(</span>shade <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="coord_3d.html">coord_3d</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in lighting(shade = "fill"):</span> unused argument (shade = "fill")</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Alpha shape (scale-sensitive - radius ~1 works for unit sphere)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sphere_points</span>, <span class="fu"><a href="aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">stat_hull_3d</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"alpha"</span>, radius <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"gray40"</span>,</span></span>
<span class="r-in"><span>               light <span class="op">=</span> <span class="fu"><a href="lighting.html">lighting</a></span><span class="op">(</span>shade <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="coord_3d.html">coord_3d</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in lighting(shade = "fill"):</span> unused argument (shade = "fill")</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Grouped hulls - separate hull for each species</span></span></span>
<span class="r-in"><span><span class="va">spheres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sphere_points</span>, group <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sphere_points</span>, group <span class="op">=</span> <span class="st">"b"</span>, x <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spheres</span>, <span class="fu"><a href="aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">stat_hull_3d</span><span class="op">(</span><span class="fu"><a href="aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        light <span class="op">=</span> <span class="fu"><a href="lighting.html">lighting</a></span><span class="op">(</span>shade <span class="op">=</span> <span class="st">"fill"</span>, shade_mode <span class="op">=</span> <span class="st">"hsl"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="coord_3d.html">coord_3d</a></span><span class="op">(</span>scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in lighting(shade = "fill", shade_mode = "hsl"):</span> unused arguments (shade = "fill", shade_mode = "hsl")</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For larger coordinate scales, increase radius proportionally:</span></span></span>
<span class="r-in"><span><span class="va">sphere_large</span> <span class="op">&lt;-</span> <span class="va">sphere_points</span> <span class="op">*</span> <span class="fl">100</span>  <span class="co"># Scale up by 100x</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sphere_large</span>, <span class="fu"><a href="aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">stat_hull_3d</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"alpha"</span>, radius <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>             fill <span class="op">=</span> <span class="st">"darkgreen"</span>, light <span class="op">=</span> <span class="fu"><a href="lighting.html">lighting</a></span><span class="op">(</span>shade <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="coord_3d.html">coord_3d</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in lighting(shade = "fill"):</span> unused argument (shade = "fill")</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

